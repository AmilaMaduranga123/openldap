#!/bin/bash

source /usr/share/openldap/common

TOOLBOXD="${BASE_CONFD}/toolbox"

tool=$(basename "$0")

if [ "${tool}" = 'adduser' ]; then
	login=$(askValue Login)
	firstname=$(askValue Firstname)
	lastname=$(askValue Lastname)
	email=$(askValue Email)
	password=$(askSecret Password)
	echo

	tmp=$(mktemp)
	replaceValues>"${tmp}" "${TOOLBOXD}/user.ldif" DC "${DC}" LOGIN "${login}" FIRSTNAME "${firstname}" LASTNAME "${lastname}" EMAIL "${email}" PASSWORD "$(escape $(slappasswd -s "${password}" -h '{SSHA}') )"

	ldapadd ${LDAP_OPTS_ADMIN} -f "${tmp}"
fi

if [ "${tool}" = 'addgroup' ]; then
	gid=$(askValue GID)

	tmp=$(mktemp)
	replaceValues>"${tmp}" "${TOOLBOXD}/group.ldif" DC "${DC}" GID "${gid}"

	ldapadd ${LDAP_OPTS_ADMIN} -f "${tmp}"
fi
