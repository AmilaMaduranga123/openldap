#!/bin/bash

source /usr/share/openldap/common

TOOLBOXD=$BASE_CONFD/toolbox

if [ $(basename $0) == 'adduser' ]; then
	LOGIN=$(askValue Login)
	FIRSTNAME=$(askValue Firstname)
	LASTNAME=$(askValue Lastname)
	EMAIL=$(askValue Email)
	PASSWORD=$(askValue Password)

	TMP=$(mktemp)
	replaceValues>$TMP $TOOLBOXD/user.ldif DC "$DC" LOGIN "$LOGIN" FIRSTNAME "$FIRSTNAME" LASTNAME "$LASTNAME" EMAIL "$EMAIL" PASSWORD "$( escape $(slappasswd -s $PASSWORD -h {SSHA}) )"

	ldapadd $LDAP_OPTS_ADMIN_SSL -f $TMP
fi

if [ $(basename $0) == 'addgroup' ]; then
	LOGIN=$(askValue UID) 

        TMP=$(mktemp)
        replaceValues>$TMP $TOOLBOXD/group.ldif DC "$DC" LOGIN "$LOGIN"

	ldapadd $LDAP_OPTS_ADMIN_SSL -f $TMP
fi
